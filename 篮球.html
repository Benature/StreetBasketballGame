<!DOCTYPE html>
<html>
<head>
    <title>篮球跳跃</title>
    <meta charset="utf-8">
</head>
<body>
<canvas id="myCanvas1" width="1000" height="1240" style="border:solid;position: absolute;z-index: 0">
    你的浏览器不支持canvas画布元素，请更新浏览器获得演示效果。
</canvas>

<script type="text/javascript">
    var canvas = document.getElementById("myCanvas1");
    var context = canvas.getContext("2d");
    context.font = "20px Arial";
    
    //var mouseX,mouseY;
    
    var ball_x = 100,
        ball_y = 250,
        ball_r = 20;//篮球ball圆心坐标,半径
    var v_x = 0,
        v_y = 1;//球分解速度
    var g   = 1;//重力加速度
    var wind   = 0.5;//台风横向加速度
    var af  = 5;//空气阻力
    var groundy = 500;//地面y值
    var t = 0;//时间
    var mouseX,mouseY;//鼠标点击坐标

    var LevelMove;//水平移动真假判断
    var lor;
    var propsplace_x1;//小道具的随机xy坐标
    var propsplace_y1 ;
    var propstime = 3;
    var propsplace_x2;
    var propsplace_y2;

    //点击鼠标触发弹起
    canvas.addEventListener("mousedown", function (e) {
        //console.log("mousedown");
        v_y = 15;
        mouseX = e.pageX - canvas.clientLeft;
        mouseY = e.pageY - canvas.clientTop;
        console.log(mouseX + "," + mouseY);
        LevelMove = true;
        lor = (mouseX > ball_x)?(1):(-1);
        v_x = 10;
        //console.log(" now should LEVEL MOVE")

    }, false);

    //水平移动
    var level_move = function(){
        if (LevelMove) {
            console.log("LEVEL MOVE!!!")
            ball_x += lor * v_x;
            v_x -= wind;
            if (v_x <= 0) {LevelMove = false}
        }
    };

    var BBU = function(){
        //Ball Bounce Up
        //篮球自己弹起来
        //ball_y -=  ((v_y * t + 0.5 * g * t*t));
        ball_y -=  ((v_y * 1 ));
        v_y -= (g * 1);
        if (ball_y>=groundy){
            //v_y = -v_y-1;
            v_y = 20;
        }
    }
    var propsimage = new Image();
    propsimage.src ="face.png";
    
    var props = function (){
         propsplace_x1 =  Math.random() * 900 + 40;//小道具的随机xy坐标
         propsplace_y1=  Math.random() * 900 + 40;
         context.drawImage(propsimage,0,0,290,285,propsplace_x1,propsplace_y1,100,98);
    }
   /* propsimage.onload() = function(){
            width = propsimage.width ;
            height =propsimage.height;
            context.clearRect(0, 0, 1000, 1240);
            var i ;
            setInterval(function(){
            var chance = Math.random() * 10;
                if (chance <= 6 && chance >= 4 ){
                    props();
                    i = 1 / 180;
                }
                else i = 1;
             t++
            
             context2.restore();
            },1000 / 60 * i)
        }*/
    var ball = new Image();
    
    ball.src = "face.png";
    ball.onload = function () {
        width = ball.width;
        height = ball.height;
        setInterval(function () {
            context.clearRect(0, 0, 1000, 1240);
            //数据显示
            context.fillText("Ball_y: "+ball_y,20,20);
            context.fillText("v_y: "+v_y,20,120);
            var t_i = 60-Math.ceil(t/60);//给界面加一个整数计时器。
            context.fillText("时间:" + t_i ,20,200) ;
          if(t_i === 55){
              props();
               propsplace_x2 = propsplace_x1;
               propsplace_y2 = propsplace_y1;
               }
               else if( 53 <= t_i < 55 ){
                context.drawImage(propsimage,0,0,290,285,propsplace_x2,propsplace_y2,100,98);
              }
            //console.log("v_y: "+v_y);

            context.save();
            //context.translate(ball_x-50, ball_y-49);
            //ball.rotate((Math.PI/180)*t)
            //context.translate(0,0);

            BBU();
            
            level_move();
            t++;


            


        
            context.drawImage(ball, 0, 0, 290,285,ball_x,ball_y,100,98);
            context.restore();
        }, 1000 / 60*1);
        

    };


</script>
</body>
</html>
